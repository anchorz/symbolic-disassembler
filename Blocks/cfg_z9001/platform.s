z9001                           =       1
z1013                           =       0
;
; z9001 specific constants
;
BOS                             =       0x0005
COUNT                           =       0x0023
ATRIB                           =       0x0027
CURS                            =       0x002d
;letztes gültiges Zeichen
LAKEY                           =       0x0024
;Tastaturpuffer
KEYBU                           =       0x0025
CURS                            =       0x002d
;erste zu rollende Zeile -1
P1ROL                           =       0x003b
;letzte zu rollende Zeile +1
P2ROL                           =       0x003c
;erste zu rollende Spalte -1
P3ROL                           =       0x003d
;letzte zu rollende Spalte +1
P4ROL                           =       0x003e
CONBU                           =       0x0080
BWS                             =       0xec00
OFFSET_COLOR                    =       0x0400
WBOOT                           =       0xF003
CONST                           =       0xF006
CONIN                           =       0xF009
COOUT                           =       0xF00C
OUTA                            =       0xf305
inkey                           =       0xFD33

UP_CONSI                        =       1
UP_CONSO                        =       2
UP_PRNST                        =       9
UP_RCONB                        =       10
UP_CSTS                         =       11
UP_SETCU                        =       18
; Löschen des Cursors
UP_DCU                          =       29

VK_CLS                          =       0x0c
VK_ENTER                        =       0x0d
;
; platform specific constants
;
SCREEN_WIDTH                    =       0x28
SCREEN_HEIGHT                   =       0x18
POSY_INPUT_LINE                 =       0x16
POSX_INPUT_LINE                 =       0x17
INPUT_LINE_size                 =       0x0f
POSITION_MOVES                  =       BWS+13*SCREEN_WIDTH+32
POSITION_SUCCESS                =       BWS+16*SCREEN_WIDTH+22
POSITION_FIELD                  =       BWS+10*SCREEN_WIDTH+3
POSITION_LEVEL                  =       BWS+9*SCREEN_WIDTH+29
POSITION_PUZZEL                 =       BWS+11*SCREEN_WIDTH+32
POSITION_INPUT_LINE             =       BWS+POSY_INPUT_LINE*SCREEN_WIDTH+POSX_INPUT_LINE

.macro CURSOR_DISABLE
        ld      c,#UP_DCU
        call    BOS
.endm

.macro UP_INCH
        ld      c,#UP_CONSI
        call    BOS
.endm

.macro  SYS_EXIT
        xor     a
        ret
.endm

.macro  CALL_OUTA
        call    OUTA
.endm

.macro  INPUT_LINE
        ld      c,#UP_RCONB
        call    BOS
.endm

.macro  SET_CURSOR ADR
.endm

.macro ROLL_SMALL_WIN
        ld      a,#VK_CLS
        CALL_OUTA
.endm

.macro  TXT_ERROR
        .asciz  'Error'
.endm

.macro MAIN_PIC
        .db     0x00,0x64,0xc8,0x00,0x30,0x2d,0x00,0x60 ;.dH.0-.`
        .db     0x4b,0x00,0x64,0x2a,0x00,0x63,0x0e,0x00 ;K.d*.c..
        .db     0x64,0x06,0x00,0x34,0x14,0x00,0x63,0x0e ;d..4..c.
        .db     0x00,0x64,0x1a,0x00,0x63,0x0e,0x00,0x34 ;.d..c..4
        .db     0x1a,0x00,0x63,0x0e,0x00,0x64,0x1a,0x00 ;..c..d..
        .db     0x63,0x0e,0x00,0x64,0x06,0x00,0x34,0x14 ;c..d..4.
        .db     0x00,0x63,0x0e,0x00,0x64,0x1a,0x00,0x63 ;.c..d..c
        .db     0x0e,0x00,0x64,0x1a,0x00,0x63,0x0e,0x00 ;..d..c..
        .db     0x64,0x1a,0x00,0x63,0x0e,0x00,0x64,0x1a ;d..c..d.
        .db     0x00,0x63,0x0e,0x00,0x64,0x06,0x34,0x00 ;.c..d.4.
        .db     0x64,0x04,0x34,0x00,0x64,0x05,0x34,0x00 ;d.4.d.4.
        .db     0x64,0x08,0x00,0x63,0x0e,0x00,0x64,0x1a ;d..c..d.
        .db     0x00,0x63,0x0e,0x00,0x64,0x1a,0x00,0x63 ;.c..d..c
        .db     0x0e,0x00,0x64,0x06,0x00,0x14,0x0f,0x00 ;..d.....
        .db     0x64,0x05,0x67,0x00,0x63,0x0d,0x00,0x64 ;d.g.c..d
        .db     0x7f,0x20,0x00,0x9e,0x28,0x20,0x20,0xa8 ;. ..(  (
        .db     0xa9,0x20,0xa1,0x20,0xa8,0xa9,0xa8,0xa0 ;) ! ()( 
        .db     0xa1,0xa1,0x20,0xa8,0xa0,0x00,0x20,0x06 ;!! ( . .
        .db     0x56,0x50,0x4f,0x48,0x4c,0x45,0x52,0x53 ;VPOHLERS
        .db     0x20,0x20,0x32,0x30,0x32,0x30,0x00,0x20 ;  2020. 
        .db     0x06,0xa3,0xa2,0xa9,0xa1,0x20,0x00,0xa1 ;.#")! .!
        .db     0x03,0x20,0xa3,0xa2,0xa9,0xa7,0xa9,0x00 ;. #")').
        .db     0x20,0x1a,0xa7,0xa0,0xaa,0xa7,0xa0,0xa7 ; .' *' '
        .db     0xaa,0xa7,0xa0,0xa1,0x20,0xa1,0xa0,0xaa ;*' ! ! *
        .db     0x00,0x20,0x04,0x2d,0x20,0x46,0x52,0x45 ;. .- FRE
        .db     0x45,0x20,0x54,0x48,0x45,0x20,0x53,0x54 ;E THE ST
        .db     0x4f,0x4e,0x45,0x20,0x2d,0x20,0x20,0x00 ;ONE -  .
        .db     0xf8,0x28,0x00,0x20,0x2d,0x45,0x2c,0x53 ;x(. -E,S
        .db     0x2c,0x44,0x2c,0x58,0x20,0x73,0x65,0x6c ;,D,X sel
        .db     0x65,0x63,0x74,0x00,0x20,0x03,0x65,0x2c ;ect. .e,
        .db     0x73,0x2c,0x64,0x2c,0x78,0x20,0x6d,0x6f ;s,d,x mo
        .db     0x76,0x65,0x00,0x20,0x58,0xbc,0x00,0xb6 ;ve. X<.6
        .db     0x0c,0xbd,0x00,0x20,0x06,0x4c,0x65,0x76 ;.=. .Lev
        .db     0x65,0x6c,0x00,0x20,0x0f,0xb4,0x00,0x20 ;el. .4. 
        .db     0x0c,0xb5,0x00,0x20,0x1a,0xb4,0x00,0x20 ;.5. .4. 
        .db     0x0c,0xb5,0x00,0x20,0x06,0x50,0x75,0x7a ;.5. .Puz
        .db     0x7a,0x6c,0x65,0x00,0x20,0x0e,0xb4,0x00 ;zle. .4.
        .db     0x20,0x0c,0xb5,0x00,0x20,0x1a,0xb4,0x00 ; .5. .4.
        .db     0x20,0x0c,0xb5,0x00,0x20,0x06,0x4d,0x6f ; .5. .Mo
        .db     0x76,0x65,0x73,0x00,0x20,0x0f,0xb4,0x00 ;ves. .4.
        .db     0x20,0x27,0xb4,0x00,0x20,0x27,0xb4,0x00 ; '4. '4.
        .db     0x20,0x0c,0xb5,0x00,0x20,0x1a,0xb4,0x00 ; .5. .4.
        .db     0x20,0x0c,0xb5,0x00,0x20,0x1a,0xb4,0x00 ; .5. .4.
        .db     0x20,0x0c,0xb5,0x00,0x20,0x06,0x43,0x6f ; .5. .Co
        .db     0x64,0x65,0x2f,0x52,0x65,0x73,0x65,0x74 ;de/Reset
        .db     0x2f,0x51,0x75,0x69,0x74,0x00,0x20,0x05 ;/Quit. .
        .db     0xb4,0x00,0x20,0x0c,0xb5,0x00,0x20,0x1a ;4. .5. .
        .db     0xb4,0x00,0x20,0x0c,0xb5,0x00,0x20,0x05 ;4. .5. .
        .db     0xa8,0x00,0xa0,0x0f,0xa9,0x00,0x20,0x04 ;(. .). .
        .db     0xb4,0x00,0x20,0x0c,0xb5,0x00,0x20,0x05 ;4. .5. .
        .db     0xa1,0x3e,0x00,0x20,0x0e,0xa1,0x00,0x20 ;!>. .!. 
        .db     0x04,0xbb,0x00,0xfb,0x0c,0xba,0x00,0x20 ;.;.{.:. 
        .db     0x05,0xa7,0x00,0xa0,0x0f,0xaa,0x00,0x20 ;.'. .*. 
        .db     0x2a,0x01                               ;*.
.endm

.macro CLS_SMALL_WINDOW
        ld      hl,#(POSY_INPUT_LINE+1)*256+(POSY_INPUT_LINE-1)
        ld      (P1ROL),hl
        ld      hl,#(POSX_INPUT_LINE+INPUT_LINE_size)*256+(POSX_INPUT_LINE-1)
        ld      (P3ROL),hl
        ld      hl,#BWS+21*SCREEN_WIDTH+22
        ld      (CURS),hl
        ld      hl,#BWS+21*SCREEN_WIDTH+22
        ld      (CURS),hl
        ld      hl,##BWS+21*SCREEN_WIDTH+22-OFFSET_COLOR
        ld      a,(hl)
        ld      (ATRIB),a
        ld      a,#VK_CLS
        call    OUTA
.endm

.macro CLS_FULL_WINDOW
        ld      hl,#(SCREEN_HEIGHT+1)*256+0
        ld      (P1ROL),hl
        ld      hl,#(SCREEN_WIDTH+1)*256+0
        ld      (P3ROL),hl
        ld      a,#FG_GREEN+BG_BLACK
        ld      (ATRIB),a
        ld      a,#VK_CLS
        call    OUTA
.endm


.macro DECOMP
decomp:
        ld      de,#BWS-OFFSET_COLOR
decomp1:
        ld      a,(hl)
        cp      #DECODE_END
        ret     z
        or      a
        jr      z,decomp3
        ld      (de),a
        inc     de
decomp2:
        inc     hl
        jr      decomp1
decomp3:
        inc     hl
        ld      a,(hl)
        inc     hl
        ld      b,(hl)
decomp4:
        ld      (de),a
        inc     de
        djnz    decomp4
        jr      decomp2
.endm

.macro PUT_A_COLORED
        ld      (hl),a
        res     2,h
        ex      af,af'
        ld      (hl),a
        ex      af,af'
        set     2,h
.endm

.macro PUT_A_COLORED_ARG COLOR
        res     2,h
        ld      a,#(COLOR)
        ld      (hl),a
        set     2,h
.endm